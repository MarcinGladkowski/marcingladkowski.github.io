{"componentChunkName":"component---src-templates-blog-post-js","path":"/step-functions-workshop/","result":{"data":{"site":{"siteMetadata":{"title":"Think Big","siteUrl":"https://marcingladkowski.pl"}},"markdownRemark":{"id":"49447210-2367-51e2-80cf-effe93948323","excerpt":"Last time I participated in workshops about AWS Step Functions. This service provided by AWS was created for implementing flow of\nour application and close the…","html":"<p>Last time I participated in workshops about <a href=\"\">AWS Step Functions</a>. This service provided by AWS was created for implementing flow of\nour application and close the paths in <a href=\"https://en.wikipedia.org/wiki/Finite-state_machine\">state machine</a>. This service can be created and maintained from Serverless Framework which\nis one of the most popular frameworks to manage cloud resources and applications. The mentors created a repository to start our journey and resolve tasks during 2 days workshop.</p>\n<h3>Advantages of step functions:</h3>\n<ul>\n<li>allow us to manage many of services in our cloud applications (ex. lambdas)</li>\n<li>visualize steps and executed path</li>\n<li>easily to find logs, passed inputs/outputs</li>\n<li>ASL to declare step flow</li>\n<li>usage with frameworks as Serverless Framework</li>\n<li>developing locally (Serverless framework with plugin)</li>\n<li>move our thinking to implement our application as small possible steps</li>\n<li>possible to usage other aws services from steps declaration</li>\n<li>…</li>\n</ul>\n<p>Started repository:  <a href=\"https://github.com/TheSoftwareHouse/tsh-academy-serverless\">https://github.com/TheSoftwareHouse/tsh-academy-serverless</a><br>\nMy repository: <a href=\"https://github.com/MarcinGladkowski/aws-step-functions-workshops\">https://github.com/MarcinGladkowski/aws-step-functions-workshops</a><br>\nStep functions and Severless framework: <a href=\"https://www.serverless.com/guides/aws-step-functions\">https://www.serverless.com/guides/aws-step-functions</a></p>\n<h4>I will go through some examples/features</h4>\n<h3>ASL - Amazon State Language</h3>\n<p>Most of examples in the documentation are in JSON bu using SF we can describe it in <strong>yml</strong></p>\n<h4>Step types</h4>\n<p>The powerful of ASF we can see on more complicated flow. Below You can see the <strong>Choice</strong> type. Similary to <strong>switch()</strong> or <strong>match()</strong>\nfunctions in programming languages. This is our first step of flow. As we can se there are some other keywords as <code class=\"language-text\">StringEquals</code> to\ncompare returned parameter.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">Comment</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Scan user CV document for data\"</span>\n<span class=\"token key atrule\">StartAt</span><span class=\"token punctuation\">:</span> checkFileType\n<span class=\"token key atrule\">States</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">checkFileType</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> Choice\n    <span class=\"token key atrule\">Choices</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Variable</span><span class=\"token punctuation\">:</span> $.extension\n        <span class=\"token key atrule\">StringEquals</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"txt\"</span>\n        <span class=\"token key atrule\">Comment</span><span class=\"token punctuation\">:</span> Is a text file<span class=\"token punctuation\">?</span>\n        <span class=\"token key atrule\">Next</span><span class=\"token punctuation\">:</span> copyFileToExtractedBucket\n    <span class=\"token key atrule\">Default</span><span class=\"token punctuation\">:</span> extractData</code></pre></div>\n<p><strong>Choice</strong> type allows to use other keywords to compare input.</p>\n<p>For example <strong>NumericGreaterThan</strong> for numeric comparison</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">checkScore</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> Choice\n    <span class=\"token key atrule\">Choices</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Variable</span><span class=\"token punctuation\">:</span> $.calculatedScore\n        <span class=\"token key atrule\">NumericGreaterThan</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span>\n        <span class=\"token key atrule\">Comment</span><span class=\"token punctuation\">:</span> Is a match<span class=\"token punctuation\">?</span>\n        <span class=\"token key atrule\">Next</span><span class=\"token punctuation\">:</span> saveToMatchedBucket\n    <span class=\"token key atrule\">Default</span><span class=\"token punctuation\">:</span> saveToRejectedBucket</code></pre></div>\n<h4>Calling services</h4>\n<p>The next one will be step with calling other service like <strong>textract:analyzeDocument</strong>.</p>\n<p>Full list of integrations:\n<a href=\"https://docs.aws.amazon.com/step-functions/latest/dg/supported-services-awssdk.html#supported-services-awssdk-list\">https://docs.aws.amazon.com/step-functions/latest/dg/supported-services-awssdk.html#supported-services-awssdk-list</a></p>\n<p>AWS service we define like <strong>arn:aws:states:::aws-sdk:[service]:[apiAction]</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">  <span class=\"token key atrule\">extractData</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> Task\n    <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>states<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">-</span>sdk<span class=\"token punctuation\">:</span>textract<span class=\"token punctuation\">:</span>analyzeDocument\n    <span class=\"token key atrule\">Parameters</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Document</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">S3Object</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">Bucket</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> inputBucket\n          <span class=\"token key atrule\">Name.$</span><span class=\"token punctuation\">:</span> $.key\n      <span class=\"token key atrule\">FeatureTypes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> TABLES\n        <span class=\"token punctuation\">-</span> FORMS\n    <span class=\"token key atrule\">ResultPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$.taskresult\"</span>\n    <span class=\"token key atrule\">Next</span><span class=\"token punctuation\">:</span> extractTe</code></pre></div>\n<h4>Parallel step execution</h4>\n<p>The best thing is that we haven’t wait for all services using language mechanism of\nasynchronous execution. I this case the result of all <strong>parallel</strong> steps will be passed\nto <strong>calculateScore</strong> at once, like one event in lambda handler.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">  <span class=\"token key atrule\">checkExperience</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> Parallel\n    <span class=\"token key atrule\">Branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">StartAt</span><span class=\"token punctuation\">:</span> checkNodeExperience\n        <span class=\"token key atrule\">States</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">checkNodeExperience</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> Task\n            <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!GetAtt</span> checkNodeExperience<span class=\"token punctuation\">-</span>lambda.Arn\n            <span class=\"token key atrule\">End</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">StartAt</span><span class=\"token punctuation\">:</span> checkCloudExperience\n        <span class=\"token key atrule\">States</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">checkCloudExperience</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> Task\n            <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!GetAtt</span> checkCloudExperience<span class=\"token punctuation\">-</span>lambda.Arn\n            <span class=\"token key atrule\">End</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">StartAt</span><span class=\"token punctuation\">:</span> checkItExperience\n        <span class=\"token key atrule\">States</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">checkItExperience</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> Task\n            <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!GetAtt</span> checkItExperience<span class=\"token punctuation\">-</span>lambda.Arn\n            <span class=\"token key atrule\">End</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">StartAt</span><span class=\"token punctuation\">:</span> checkExcludeLists\n        <span class=\"token key atrule\">States</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">checkExcludeLists</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> Task\n            <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!GetAtt</span> checkExcludeLists<span class=\"token punctuation\">-</span>lambda.Arn\n            <span class=\"token key atrule\">End</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">Next</span><span class=\"token punctuation\">:</span> calculateScore</code></pre></div>\n<p>Full workflow implemented on workshop</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dddc482f54ece7bfbbb1f7c912a96449/f6386/step_functions_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRp4AAABXRUJQVlA4IJIAAAAwBACdASoUABQAPtFep0+oJKMiKAgBABoJagC/Sf/gHf6+hBJGvNn9nOQA/vYJxwMFfEvtHUSGz+1czfFInQp197mC9ndK34XJsqDyzdZvZDeDPaEaQ//IZ7WFZ0TULD1xr8GbXHaAmr4/Y94rf4yOz3OayO4fMrx/2NcY/LOxSvon5t1DXl0lp+ds7nd1nggAAA=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"step_functions_1\"\n        title=\"\"\n        src=\"/static/dddc482f54ece7bfbbb1f7c912a96449/f058b/step_functions_1.png\"\n        srcset=\"/static/dddc482f54ece7bfbbb1f7c912a96449/c26ae/step_functions_1.png 158w,\n/static/dddc482f54ece7bfbbb1f7c912a96449/6bdcf/step_functions_1.png 315w,\n/static/dddc482f54ece7bfbbb1f7c912a96449/f058b/step_functions_1.png 630w,\n/static/dddc482f54ece7bfbbb1f7c912a96449/f6386/step_functions_1.png 686w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Of course, the step functions has a lot of more features like graphical editor, executing in loops and others.</p>\n<p>Best,\nMarcin</p>","frontmatter":{"title":"The next step is... AWS Step Functions","date":"June 28, 2022","description":null}},"previous":{"fields":{"slug":"/symfony-fast-track/"},"frontmatter":{"title":"Symfony Fast Track"}},"next":{"fields":{"slug":"/phpcon-2022/"},"frontmatter":{"title":"PHPcon Poland 2022"}}},"pageContext":{"id":"49447210-2367-51e2-80cf-effe93948323","previousPostId":"5c954382-7b94-5ca8-b646-49bbf12a1413","nextPostId":"d823c89f-46c4-5bac-bad6-89a31733e68c"}},"staticQueryHashes":["4135132960","805692932"],"slicesMap":{}}